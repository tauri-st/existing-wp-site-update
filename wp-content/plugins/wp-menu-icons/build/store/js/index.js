(()=>{"use strict";var e={n:r=>{var t=r&&r.__esModule?()=>r.default:()=>r;return e.d(t,{a:t}),t},d:(r,t)=>{for(var s in t)e.o(t,s)&&!e.o(r,s)&&Object.defineProperty(r,s,{enumerable:!0,get:t[s]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},r={};e.r(r),e.d(r,{INITIAL_STATE:()=>c,STORE_NAME:()=>o,WPMI_STORE_NAME:()=>G,actions:()=>s,apiFetch:()=>S,fetchRestApiDeleteLibrary:()=>R,fetchRestApiLibraries:()=>f,fetchRestApiLibrariesUpload:()=>_,fetchRestApiMenu:()=>w,fetchRestApiSettings:()=>v,getIcons:()=>E,reducer:()=>a,resolvers:()=>i,selectors:()=>t,useCurrentLibrary:()=>I,useCurrentLibraryIconMap:()=>T,useLibraries:()=>C,useSettingsEntities:()=>A});var t={};e.r(t),e.d(t,{getCurrentLibrary:()=>d,getCurrentLibraryName:()=>l,getLibraries:()=>u,getSettings:()=>b});var s={};e.r(s),e.d(s,{deleteLibrary:()=>O,saveSettings:()=>$,setCurrentLibraryName:()=>k,setLibraries:()=>M,setSettings:()=>P,uploadLibrary:()=>j});var i={};e.r(i),e.d(i,{getCurrentLibraryName:()=>F,getLibraries:()=>B,getSettings:()=>D});var a={};e.r(a),e.d(a,{default:()=>x});const n=window.wp.data,o="wpmi/store",c={currentLibraryName:"dashicons",settings:{active_libraries:[]},libraries:[]},u=e=>e.libraries,l=e=>e.currentLibraryName,d=e=>{const{libraries:r,currentLibraryName:t}=e;return r.find((e=>e.name===t))},b=e=>e.settings,y=window.wp.i18n,p=window.wp.notices,h=window.wp.apiFetch;var g=e.n(h);const L=window.wp.element,{WPMI_REST_ROUTES:m}=wpmi_store;async function S(e){return await g()(e).then((e=>e)).catch((e=>{throw new Error(e)}))}const f=({method:e,data:r,headers:t}={})=>S({path:m.libraries,method:e,data:r,headers:t}),_=({method:e,body:r,headers:t}={})=>S({path:m.libraries_upload,method:e,body:r,headers:t}),R=e=>S({path:m.libraries+`?library_name=${e}`,method:"DELETE"}),v=({method:e,data:r}={})=>S({path:m.settings,method:e,data:r}),w=e=>S({path:m.navmenu+"?id="+e}),N=(()=>{const e=document.createElement("link");return e.rel="stylesheet",e.href="",document.head.append(e),{setHref:r=>{r&&(e.href=r)}}})(),E=async e=>{if(!e.is_loaded)return[];if(e.iconmap)return e.iconmap.split(",");if(e.json_file_url){const r=await fetch(new Request(e.json_file_url,{cache:"no-store"}));if(!r.ok)return[];const t=await r.json(),{prefix:s}=e;return t.IcoMoonType?t.icons.map((e=>s+e.properties.name)):t.glyphs.map((e=>s+e.css))}return[]},T=()=>{const[e,r]=(0,L.useState)([]),[t,s]=(0,L.useState)(!1),i=(0,n.useSelect)((e=>{const{getCurrentLibrary:r}=e(o);return r()}),[]);return(0,L.useEffect)((()=>{i?(s(!0),E(i).then((e=>{r(e),s(!1)}))):r([])}),[i]),{iconMap:e,isLoadingIconMap:t,filterIcons:r=>e.filter((e=>e.includes(r)))}},C=()=>{const{libraries:e,isResolvingLibraries:r,hasResolvedLibraries:t}=(0,n.useSelect)((e=>{const{getLibraries:r,isResolving:t,hasFinishedResolution:s}=e(o);return{libraries:r(),isResolvingLibraries:t("getLibraries"),hasResolvedLibraries:s("getLibraries")}}),[]),{uploadLibrary:s,deleteLibrary:i}=(0,n.useDispatch)(o);return{libraries:e,isResolvingLibraries:r,hasResolvedLibraries:t,hasLibraries:!(!t||!e?.length),uploadLibrary:s,deleteLibrary:i}},I=()=>{const{currentLibrary:e,currentLibraryName:r,isResolvingCurrentLibrary:t,hasResolvedCurrentLibrary:s}=(0,n.useSelect)((e=>{const{getCurrentLibraryName:r,getLibraries:t,isResolvingCurrentLibrary:s,hasFinishedResolution:i}=e(o),a=document.getElementById("menu")?.value,n=t(),c=r(a),u=n.find((e=>e.name===c));if(u?.is_loaded){const{stylesheet_file_url:e=""}=u;N.setHref(e)}return{currentLibrary:u,currentLibraryName:c,isResolvingCurrentLibrary:s,hasResolvedCurrentLibraryName:i("getCurrentLibraryName")}}),[]),{setCurrentLibraryName:i}=(0,n.useDispatch)(o);return{currentLibrary:e,currentLibraryName:r,setCurrentLibraryName:i,isResolvingCurrentLibrary:t,hasResolvedCurrentLibrary:s}};function A(){const{saveSettings:e,setSettings:r}=(0,n.useDispatch)(o),{settings:t,isResolvingSettings:s,hasResolvedSettings:i}=(0,n.useSelect)((e=>{const{isResolving:r,hasFinishedResolution:t,getSettings:s}=e(o);return{settings:s(),isResolvingSettings:r("getSettings"),hasResolvedSettings:t("getSettings")}}),[]);return{settings:t,isResolvingSettings:s,hasResolvedSettings:i,hasSettings:!(!i||!Object.keys(t)?.length),saveSettings:e,setSettings:r}}const M=e=>({type:"SET_LIBRARIES",payload:e}),j=({body:e,headers:r})=>async({registry:t,dispatch:s,select:i})=>{const a=await _({method:"POST",body:e,headers:r});if(a?.code||0===a?.code)return t.dispatch(p.store).createSuccessNotice((0,y.sprintf)("%1$s: %2$s",a.code,a.message),{type:"snackbar"}),!1;const n=i.getLibraries(),o=a,c=n.findIndex((e=>e.name===o.name));return n[c]={...n[c],json_file_url:o.json_file_url,stylesheet_file_url:o.stylesheet_file_url,is_loaded:!0},s.setLibraries([...n]),s.setCurrentLibraryName(o.name),t.dispatch(p.store).createSuccessNotice((0,y.__)("The library has been created successfully.","wp-menu-icons"),{type:"snackbar"}),!0},O=e=>async({registry:r,dispatch:t,select:s})=>{const i=await R(e);if(i?.code)return r.dispatch(p.store).createSuccessNotice((0,y.sprintf)("%1$s: %2$s",i.code,i.message),{type:"snackbar"}),!1;const a=s.getLibraries(),n=a.findIndex((r=>r.name===e));return a[n]={...a[n],stylesheet_file_url:!1,json_url:!1,is_loaded:!1},t.setLibraries([...a]),r.dispatch(p.store).createSuccessNotice((0,y.sprintf)((0,y.__)("%s succesfully deleted!","wp-menu-icons"),a[n].label),{type:"snackbar"}),t.setCurrentLibraryName(e),!0},k=e=>({type:"SET_CURRENT_LIBRARY_NAME",payload:e}),P=e=>({type:"SET_SETTINGS",payload:e}),$=e=>async({registry:r,dispatch:t})=>{const s=await v({method:"POST",data:e});return s?.code?(r.dispatch(p.store).createSuccessNotice((0,y.sprintf)("%1$s: %2$s",s.code,s.message),{type:"snackbar"}),!1):(t.setSettings({...e}),r.dispatch(p.store).createSuccessNotice((0,y.__)("Settings saved.","wp-menu-icons"),{type:"snackbar"}),!0)},B=async()=>{try{const e=await f();return M(Object.values(e))}catch(e){console.error(e)}},D=async()=>{try{const e=await v();return P(e)}catch(e){console.error(e)}},F=async e=>{try{const r=await w(e);return k(r)}catch(e){console.error(e)}};function x(e=c,r){switch(r.type){case"SET_LIBRARIES":return{...e,libraries:r.payload};case"SET_CURRENT_LIBRARY_NAME":return{...e,currentLibraryName:r.payload};case"SET_SETTINGS":return{...e,settings:r.payload}}return e}const U=(0,n.createReduxStore)(o,{reducer:x,actions:s,selectors:t,resolvers:i});(0,n.register)(U);const G=o;(window.wpmi=window.wpmi||{}).store=r})();